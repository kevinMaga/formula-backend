generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  nombre    String
  rol       Rol      @default(EMPRENDEDOR)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  formulaciones Formulacion[]
}

enum Rol {
  EMPRENDEDOR
  PRO
  CORPORATIVO
}

model Formulacion {
  id          String   @id @default(uuid())
  nombre      String
  descripcion String?
  categoria   Categoria @relation(fields: [categoriaId], references: [id])
  categoriaId String
  usuario     Usuario   @relation(fields: [usuarioId], references: [id])
  usuarioId   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  ingredientes FormulacionIngrediente[]
}

model Categoria {
  id            String        @id @default(uuid())
  nombre        String        @unique
  descripcion   String?
  formulaciones Formulacion[]
}

model Ingrediente {
  id          String   @id @default(uuid())
  nombre      String   @unique
  descripcion String?
  
  // Valores nutricionales por 100g
  calorias      Float
  proteinas     Float
  grasas        Float
  carbohidratos Float
  fibra         Float?
  sodio         Float?
  
  unidadBase    String  // g, ml, unidad
  
  formulaciones FormulacionIngrediente[]
}

model FormulacionIngrediente {
  id             String      @id @default(uuid())
  formulacion    Formulacion @relation(fields: [formulacionId], references: [id], onDelete: Cascade)
  formulacionId  String
  ingrediente    Ingrediente @relation(fields: [ingredienteId], references: [id])
  ingredienteId  String
  cantidad       Float
  unidad         String
  
  @@unique([formulacionId, ingredienteId])
}